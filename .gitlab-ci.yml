---

image: bo01-vm-nexus01.node.bo01.noroutine.me:5000/infra/builder:v0.0.21

variables:
  FF_DISABLE_UMASK_FOR_DOCKER_EXECUTOR: 1

stages:
  - build

zeppelin:
  stage: build
  parallel:
    matrix:
      - SPARK_VERSION: [ "2.4.7" ]
        HADOOP_VERSION: [ "2.7" ]
      - SPARK_VERSION: [ "3.0.1" ]
        HADOOP_VERSION: [ "2.7", "3.2" ]

  script:
    - export REPO=${DOCKER_HUB}/datascienceplatform/dork
    - export COMMIT=${CI_COMMIT_TAG:-${CI_COMMIT_SHORT_SHA}}
    - curl -s http://archive.apache.org/dist/spark/spark-${SPARK_VERSION}/spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz | tar -xz -C .
    - mv spark-* spark
    - docker build -t $REPO:$COMMIT .
    - docker tag $REPO:$COMMIT $REPO:$COMMIT-s${SPARK_VERSION}-h${HADOOP_VERSION}
    - docker push $REPO:$COMMIT-s${SPARK_VERSION}-h${HADOOP_VERSION}
